<HTML>
<HEAD>
        <TITLE> Журнал ЦПО. Дистанционное обучение. </TITLE>
        <META NAME="Author" CONTENT="Olga Pavlova (OP), CHANCE Publishing House">
</HEAD>

<BODY BGCOLOR="#EFEFEF" TEXT="Black" LINK="Teal" VLINK="Gray" ALINK="#B3CFC4">


<TABLE WIDTH="100%" BORDER="0" CELLSPACING="0" CELLPADDING="0">
<TR>
        <TD width=2% ROWSPAN="2" BGCOLOR="#82B496">&nbsp;</TD>
        <TD width=2% ROWSPAN="2" BGCOLOR="Black">&nbsp;</TD>
        <TD ALIGN="CENTER" BGCOLOR="Gray">
        <FONT COLOR="White">
        <EM>Компьютерные</EM><BR>
        <FONT SIZE="+1"><STRONG>ИНСТРУМЕНТЫ</STRONG></FONT><BR>
        <EM>в образовании</EM>
        </FONT>
        </TD>
        <TD width=2% ROWSPAN="2" BGCOLOR="Black">&nbsp;</TD>
        <TD width=2% ROWSPAN="2" BGCOLOR="#82B496">&nbsp;</TD>
</TR>

<TR>
        <TD BGCOLOR="Black">&nbsp;</TD>
</TR>

<TR>
<TD COLSPAN="5" ALIGN="CENTER" VALIGN="MIDDLE" BGCOLOR="#82B496">
<FONT SIZE="-1">
<HR SIZE="1" NOSHADE>
[ <A HREF="index.html">начало</A> ] [ <A HREF="http://www.aec.neva.ru/center/">ЦПО</A> ] [ <A HREF="mailto:pozdnkov@aec.neva.ru">e-mail</A> ] 
<HR SIZE="1" NOSHADE>
</FONT>
</TD>
</TR>
</TABLE>

<TABLE WIDTH="100%" BORDER="0" CELLSPACING="0" CELLPADDING="0" ALIGN="CENTER" VALIGN="MIDDLE" NOWRAP BGCOLOR="#82B496">
<TR>
<TD WIDTH="30%" ALIGN="CENTER" VALIGN="MIDDLE"><FONT COLOR="White" SIZE="+2"><EM>&nbsp;УЧЕБНАЯ&nbsp;<BR>
&nbsp;МАСТЕРСКАЯ&nbsp;</EM></FONT></TD>

<TD WIDTH="70%" BGCOLOR="#EFEFEF">
<P ALIGN="RIGHT"><FONT SIZE="-1"><EM>Пискарев Алексей Валерьевич&nbsp;&nbsp;&nbsp;</EM></FONT></P>

<H3 ALIGN="CENTER">О трассировке лучей</H3>
&nbsp;
</TD>
</TR>

<TR>
<TD COLSPAN="2">&nbsp;</TD>
</TR>
</TABLE>

<TABLE WIDTH="100%" BORDER="0" CELLSPACING="0" CELLPADDING="3" BGCOLOR="#82B496">
<TR>
<TD WIDTH="97%" BGCOLOR="#EFEFEF">
<BLOCKQUOTE>
<P>&nbsp;
<P>&nbsp;&nbsp;&nbsp;<STRONG>О</STRONG>дним из наиболее эффективных способов построения реалистических изображений на основе гипотетических сцен является так называемый метод трассировки лучей (ray tracing).
<P>&nbsp;&nbsp;&nbsp;<STRONG>Ч</STRONG>еловеческий глаз "видит" различные предметы из-за того, что он поглощает световые лучи, отраженные от этих предметов. Метод  трассировки лучей сводится к моделированию "судьбы" луча, выпущенного источником света. Выпущенный луч, распространяясь прямолинейно, падает на какой-нибудь из объектов сцены. На поверхности этого объекта луч частично отражается, частично поглощается, частично преломляется. Таким образом, обнаружив падение некоего луча на объект сцены, нам вместо одного следует далее отслеживать уже два луча: отраженный и преломленный. Каждого из них ждет аналогичная участь. С прохождением расстояния луч света затухает, и мы отказываемся от дальнейшей его "трассировки" (отслеживания), если он станет слишком слабым. Мы должны трассировать каждый отдельный луч и им порожденные до той поры, пока мы не обнаружим, что он попал в "глаз" к гипотетическому наблюдателю (тогда следует отметить, какую "информацию" он с собой принес), или что он потух с пройденным расстоянием, или что он не падает ни на один объект сцены (то есть уносится в бесконечность).
<P>&nbsp;&nbsp;&nbsp;<STRONG>М</STRONG>етод отслеживания луча от момента выхода его из источника света плох тем, что большинство выпущенных лучей никогда не попадут в глаз наблюдателя; невозможно предсказать, попадет очередной луч в глаз или нет. Поэтому чаще практикуется метод "обратной" трассировки лучей, который обычно и понимается под названием "трассировка лучей". В методе обратной трассировки отслеживается, откуда пришел луч, под определенным углом попавший в глаз наблюдателя. (Правильность такого подхода объясняется принципом обратимости хода луча света, который гласит, что луч, "двигаясь" в противоположном направлении, пройдет в пространстве тот же самый путь.) Выясняется, какой объект был последним на пути луча. Световая энергия, попавшая к наблюдателю от данной точки поверхности найденного объекта, складывается из энергии лучей, которые были в этой точке отражены или преломлены, за вычетом энергии, поглощенной объектом.
<P>&nbsp;&nbsp;&nbsp;<STRONG>О</STRONG>сновная задача метода трассировки лучей заключается в том, чтобы определить освещенность некоей заданной точки  на поверхности произвольного объекта и определить, из чего эта освещенность сложилась. Обычно рассматривается освещенность непосредственная (первичная), то есть имеющая место вследствие падения на поверхность объекта прямого света от источников, и освещенность вторичная, то есть от других объектов сцены.
<P>&nbsp;&nbsp;&nbsp;<STRONG>Р</STRONG>ассмотрим подробнее процесс определения освещенности. Пусть мы определили, что некий луч i попал к нам в глаз, побывав в точке A поверхности Q. В точке A восстановлен перпендикуляр n, отмечены луч падающего света r, луч t света, проникающего из "нижней" среды, угол падения света a и угол отражения света b, а также угол c между лучом t и нормалью n (схема 1). Чтобы определить освещенность поверхности Q в точке A, найдем отдельные составляющие этой освещенности, привносимые лучами t и r , а также попытаемся определить освещенность поверхности вследствие диффузных отражения и преломления.
</BLOCKQUOTE>
<P>&nbsp;
</TD>

<TD WIDTH="3%">&nbsp;</TD>
</TR>
</TABLE>

<TABLE WIDTH="100%" BORDER="0" CELLSPACING="0" CELLPADDING="3" BGCOLOR="#82B496">
<TR>
<TD COLSPAN="2" ALIGN="CENTER"><FONT SIZE="+1" COLOR="White"><STRONG>&nbsp;Схема 1&nbsp;</STRONG></FONT></TD>
</TR>

<TR>
<TD WIDTH="3%">&nbsp;</TD>

<TD WIDTH="97%" ALIGN="CENTER" BGCOLOR="#EFEFEF">
<IMG SRC="../aim/96_1.gif" WIDTH=341 HEIGHT=205 VSPACE=10 BORDER=0 ALT="Схема 1">
</TD>
</TR>
</TABLE>

<TABLE WIDTH="100%" BORDER="0" CELLSPACING="0" CELLPADDING="3" BGCOLOR="#82B496">
<TR>
<TD COLSPAN="2" ALIGN="CENTER">&nbsp;</TD>
</TR>

<TR>
<TD WIDTH="97%" BGCOLOR="#EFEFEF">
<BLOCKQUOTE>
<P>&nbsp;
<P>&nbsp;&nbsp;&nbsp;<STRONG>О</STRONG>пределим прямое освещение точки A источниками света. Чтобы это сделать, для каждого источника света S построим отрезок AS и проверим, не пересекается ли этот отрезок с какими-либо объектами сцены. Если пересекается, то мы не станем рассматривать прямое освещение точки A соответствующим источником. Для определения освещения точки A источником S следует вычислить угол j (см. схему); понятно, что, чем меньше угол j, тем более яркой видится нам точка A. Поэтому для определения прямого освещения точки поверхности необходимо задаться некоторой функцией p, которая определяла бы освещенность точки A в зависимости от угла j; при j=0 p принимает определенное положительное значение, при j, возрастающем от 0 до p/2, p монотонно уменьшается до нуля. Чаще всего в качестве такой функции берут определенную натуральную степень косинуса j:  . В таком случае показатель n именуется "коэффициентом Фонга"; чем большее значение этого коэффициента мы назначим, тем быстрее будет спадать освещенность точки с ростом j, тем уже, стало быть, будет световое пятно на поверхности.
<P>&nbsp;&nbsp;&nbsp;<STRONG>О</STRONG>пределим информацию, приносимую лучом r. Для этого из точки A выпустим луч в направлении, противоположном r, и отследим его судьбу аналогично лучу i. Так же поступим с лучом t.
<P>&nbsp;&nbsp;&nbsp;<STRONG>В</STRONG>ычисляя различные составляющие освещенности, мы оперируем векторами в трехмерном пространстве. Такими операциями невозможно точно выяснить диффузные компоненты освещенности, так как для этого пришлось бы работать с бесконечным числом векторов. Поэтому мы для компенсации этой "потери" вводим так называемую "фоновую" освещенность: ничем не затеняемый свет, падающий на поверхность равномерно по всем направлениям.
<P>&nbsp;&nbsp;&nbsp;<STRONG>П</STRONG>одсчитав различные элементы освещенности, следует сложить их воедино. Для такого сложения вводятся весовые коэффициенты фоновой, зеркальной, отраженной и преломленной освещенности. Общая освещенность точки поверхности вычисляется как сумма отдельных составляющих, причем каждая берется с соответствующим коэффициентом. К примеру, если определено, что заданная поверхность не отражает свет, то коэффициент вклада отраженного луча назначается равным нулю, и тогда на общую освещенность не повлияет информация, принесенная лучом r.
<P>&nbsp;&nbsp;&nbsp;<STRONG>Р</STRONG>аспространение света в однородной среде происходит прямолинейно и с постоянной скоростью. При этом свет затухает, и затухание это происходит по экспоненциальному закону, то есть с прохождением любых двух равных по длине отрезков пути в одной и той же среде свет затухает в одно и то же количество раз. Интенсивность света, прошедшего расстояние l:  . Здесь   - начальная интенсивность света, b - коэффициент затухания (свойство среды распространения). Это обстоятельство учитывается при подсчете информации, приносимой вновь выпускаемым лучом: готовая цифра домножается на  .
<P>&nbsp;&nbsp;&nbsp;<STRONG>Т</STRONG>аким образом, для построения полного изображения сцены следует через каждый пиксел будущей картины выпустить луч и отследить последнее пересечение этого луча с объектами сцены. Далее следует расчет прямой освещенности найденного объекта источниками света. После этого выпускаются для трассировки лучи, из которых исходный получился как отраженный или преломленный. Эти два луча трассируются аналогично первому. Мы отказываемся от отслеживания нового луча, как только станет понятно, что в конечную картину он не приносит заметного вклада: это тогда, когда новый луч стал слишком далеким "потомком" первого луча, или когда новый луч должен пройти слишком большое расстояние, чтобы попасть в наше изображение.
<P>&nbsp;&nbsp;&nbsp;<STRONG>Н</STRONG>а второй странице обложки приведен пример картины, построенной с применением метода обратной трассировки лучей. В пространстве сцены расположена "комната" из шести плоскостей, разных по свойствам, стеклянная колонна, два шара: матовый красный и глянцевый зеленый, и источник света (схема 2).

</BLOCKQUOTE>
<P>&nbsp;
</TD>

<TD WIDTH="3%">&nbsp;</TD>
</TR>
</TABLE>

<TABLE WIDTH="100%" BORDER="0" CELLSPACING="0" CELLPADDING="3" BGCOLOR="#82B496">
<TR>
<TD COLSPAN="2" ALIGN="CENTER"><FONT SIZE="+1" COLOR="White"><STRONG>&nbsp;Схема 2&nbsp;</STRONG></FONT></TD>
</TR>

<TR>
<TD WIDTH="3%">&nbsp;</TD>

<TD WIDTH="97%" ALIGN="CENTER" BGCOLOR="#EFEFEF">
<IMG SRC="../aim/96_2.gif" WIDTH=187 HEIGHT=186 BORDER=0 ALT="Схема 2" VSPACE=10>
</TD>
</TR>
</TABLE>

<TABLE WIDTH="100%" BORDER="0" CELLSPACING="0" CELLPADDING="3" BGCOLOR="#82B496">
<TR>
<TD COLSPAN="2" ALIGN="CENTER">&nbsp;</TD>
</TR>

<TR>
<TD WIDTH="97%" BGCOLOR="#EFEFEF">
<BLOCKQUOTE>
<P>&nbsp;
<P>&nbsp;&nbsp;&nbsp;<STRONG>Д</STRONG>ля примера на второй странице обложки приведены в качестве рисунков 2 и 3 изображения той же сцены, что и на рисунке 1. Конфигурация сцены та же, и так же расположен "наблюдатель", но в сцене на рисунке 2 объекты не отражают света (коэффициенты вклада для отраженного луча для всех объектов равны нулю); в просчете изображения сцены на рисунке 3 применена менее глубокая рекурсия при трассировке лучей: на рисунке 1 для каждого исходного луча отслеживались его "потомки" десятого "колена", а на рисунке 3 - только второго. Также на рисунке 3 для красного шара задан более высокий, чем на рисунке 1, коэффициент Фонга; обратите внимание, что световое пятно на красном шаре на рисунке 3 уже, чем на рисунке 1.
<P>&nbsp;&nbsp;&nbsp;<STRONG>Д</STRONG>ля более подробного ознакомления с возможностями метода трассировки лучей без погружения в возможные насущные проблемы можно почитать книги, приведенные в списке литературы.
<P>&nbsp;&nbsp;&nbsp;<STRONG>Н</STRONG>а прилагаемой к журналу дискете записана программа для среды MS DOS, строящая изображение в формате BMP по методу трассировки лучей. При написании программы использовались алгоритмы, описанные в [1], а также алгоритмы, разработанные в Физико-математической гимназии ¦30 (Санкт-Петербург). Об использовании программы см. текст в файле README.TXT .


</BLOCKQUOTE>
<P>&nbsp;
</TD>

<TD WIDTH="3%">&nbsp;</TD>
</TR>
</TABLE>

<TABLE WIDTH="100%" BORDER="0" CELLSPACING="0" CELLPADDING="3" BGCOLOR="#82B496">
<TR>
<TD COLSPAN="2" ALIGN="CENTER"><FONT SIZE="+1" COLOR="White"><STRONG>&nbsp;Литература&nbsp;</STRONG></FONT></TD>
</TR>

<TR>
<TD WIDTH="3%">&nbsp;</TD>

<TD WIDTH="97%" BGCOLOR="#EFEFEF">
<BLOCKQUOTE>
<P>&nbsp;
<OL>
<LI> Шикин Е.В. Боресков А.В. Компьютерная графика. Динамика, реалистические изображения.  Москва: ДИАЛОГ-МИФИ, 1995;
<LI> Иванов В.П. Батраков А.С. Трехмерная компьютерная графика. Москва: Радио и связь, 1995.
</OL>

</BLOCKQUOTE>
<P>&nbsp;
</TD>
</TR>
</TABLE>

<TABLE WIDTH="100%" BORDER="0" CELLSPACING="0" CELLPADDING="0" ALIGN="CENTER" VALIGN="MIDDLE" NOWRAP BGCOLOR="#82B496">
<TR>
<TD COLSPAN="2">&nbsp;</TD>
</TR>

<TR>
<TD WIDTH="70%" BGCOLOR="#EFEFEF">
<BLOCKQUOTE>
<P>&nbsp;<BR>
<STRONG>Пискарев Алексей Валерьевич</STRONG><BR>
<P><EM>В 1996 году закончил <A HREF="http://www.bz.spb.su/30school/">физико-математическую гимназию N<SUP>o</SUP> 30</A>,<BR>
студент II курса факультета информатики и вычислительной техники <A HREF="http://www.etu.ru">СПбГЭТУ</A>.       </EM>

</BLOCKQUOTE>
<P>&nbsp;
</TD>

<TD WIDTH="30%" ALIGN="CENTER" VALIGN="MIDDLE"><FONT COLOR="White" SIZE="+2"><EM>&nbsp;НАШИ&nbsp;АВТОРЫ&nbsp;</EM></FONT></TD>
</TR>
<TR>
<TD COLSPAN="2" ALIGN="CENTER" VALIGN="MIDDLE" BGCOLOR="#82B496">
<FONT SIZE="-1">
<HR SIZE="1" NOSHADE>
[ <A HREF="index.html">начало</A> ] [ <A HREF="http://www.aec.neva.ru/center/">ЦПО</A> ] [ <A HREF="mailto:pozdnkov@aec.neva.ru">e-mail</A> ] 
<HR SIZE="1" NOSHADE>
</FONT>
</TD>
</TR>
</TABLE>

</BODY>
</HTML>
